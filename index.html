
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ðŸ‘ª Family Calendar</title>
  <link href="="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="family-icon-192x192.png"/>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #calendar { max-width: 900px; margin: auto; }
    .fc-event { cursor: pointer; }
    #event-form { display: none; background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 20px; }
    select, input { margin: 5px 0; padding: 5px; width: 100%; }
    #calendar, #event-form { display: none; }
  </style>
</head>
<body>
  <h2>ðŸ‘ª Family Calendar</h2>

  <div id="auth-section">
    <h2>Login or Sign Up</h2>
    <input type="email" id="auth-email" placeholder="Email"><br>
    <input type="password" id="auth-password" placeholder="Password"><br>
    <button onclick="signUp()">Sign Up</button>
    <button onclick="logIn()">Log In</button>
    <button onclick="logOut()">Log Out</button>
    <p id="auth-status"></p>
  </div>

  <div id="event-form">
    <input type="hidden" id="event-id">
    <label>Title:</label><input type="text" id="event-title">
    <label>Date:</label><input type="date" id="event-date">
    <button onclick="saveEvent()">Save</button>
    <button onclick="cancelEvent()">Cancel</button>
  </div>
  <div id="calendar"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, set, remove, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB6dFxZiIuwfobxGRxcfaNsoUeDiDV_1dQ",
      authDomain: "familycalendar-1587d.firebaseapp.com",
      databaseURL: "https://familycalendar-1587d-default-rtdb.firebaseio.com",
      projectId: "familycalendar-1587d",
      storageBucket: "familycalendar-1587d.appspot.com",
      messagingSenderId: "667608245714",
      appId: "1:667608245714:web:fdcc88f2317992d4f1140b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let calendar;

    function initCalendar() {
      const calendarEl = document.getElementById("calendar");
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: "dayGridMonth",
        dateClick: function(info) {
          document.getElementById("event-form").style.display = "block";
          document.getElementById("event-id").value = "";
          document.getElementById("event-title").value = "";
          document.getElementById("event-date").value = info.dateStr;
        },
        eventClick: function(info) {
          if (confirm("Delete this event?")) {
            deleteEventFromFirebase(info.event.id);
            info.event.remove();
          }
        }
      });
      calendar.render();
      loadEvents();
    }

    function loadEvents() {
      const eventsRef = ref(db, "events");
      onValue(eventsRef, (snapshot) => {
        const data = snapshot.val() || {};
        const events = Object.values(data);
        calendar.removeAllEvents();
        calendar.addEventSource(events);
      });
    }

    function saveEvent() {
      const id = document.getElementById("event-id").value || Date.now().toString();
      const title = document.getElementById("event-title").value;
      const date = document.getElementById("event-date").value;
      if (!title || !date) return;
      const event = { id, title, start: date };
      set(ref(db, "events/" + id), event);
      calendar.addEvent(event);
      cancelEvent();
    }

    function cancelEvent() {
      document.getElementById("event-form").style.display = "none";
    }

    function deleteEventFromFirebase(id) {
      remove(ref(db, "events/" + id));
    }

    window.signUp = function () {
      const email = document.getElementById("auth-email").value;
      const password = document.getElementById("auth-password").value;
      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          document.getElementById("auth-status").textContent = "Signed up as " + userCredential.user.email;
        })
        .catch((error) => {
          document.getElementById("auth-status").textContent = error.message;
        });
    };

    window.logIn = function () {
      const email = document.getElementById("auth-email").value;
      const password = document.getElementById("auth-password").value;
      signInWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          document.getElementById("auth-status").textContent = "Logged in as " + userCredential.user.email;
        })
        .catch((error) => {
          document.getElementById("auth-status").textContent = error.message;
        });
    };

    window.logOut = function () {
      signOut(auth).then(() => {
        document.getElementById("auth-status").textContent = "Logged out.";
        document.getElementById("calendar").style.display = "none";
        document.getElementById("event-form").style.display = "none";
      });
    };

    onAuthStateChanged(auth, (user) => {
      if (user) {
        document.getElementById("auth-status").textContent = "Welcome, " + user.email;
        document.getElementById("calendar").style.display = "block";
        initCalendar();
      } else {
        document.getElementById("calendar").style.display = "none";
      }
    });
  </script>
</body>
</html>
